# ダークモード実装計画

## 1. 実装概要

NotebookLM Reading List Extensionにダークモードを実装するための包括的な計画書です。

## 2. 技術的アプローチ

### 2.1 CSS変数（カスタムプロパティ）の導入
現在ハードコードされている色をCSS変数に置き換え、テーマの切り替えを容易にします。

```css
:root {
  /* ライトモードのデフォルト値 */
  --color-primary: #1a73e8;
  --color-background: #f8f9fa;
  --color-text-primary: #202124;
  /* ... その他の色 */
}

[data-theme="dark"] {
  /* ダークモードの値 */
  --color-primary: #8ab4f8;
  --color-background: #202124;
  --color-text-primary: #e8eaed;
  /* ... その他の色 */
}
```

### 2.2 色の変換マッピング

#### 背景色
| ライトモード | ダークモード | 用途 |
|------------|------------|------|
| #f8f9fa | #202124 | メイン背景 |
| #fff | #292a2d | カード背景 |
| #e8f0fe | #1e3a5f | 選択状態背景 |
| #e3f2fd | #1e3a5f | 音声プレーヤー背景 |
| #fff5f1 | #3d2a26 | 再生中背景 |
| #fef7f5 | #3d2626 | 独立プレーヤー背景 |

#### テキスト色
| ライトモード | ダークモード | 用途 |
|------------|------------|------|
| #202124 | #e8eaed | プライマリテキスト |
| #5f6368 | #9aa0a6 | セカンダリテキスト |
| #8e8e8e | #6e7681 | ターシャリテキスト |

#### ボーダー色
| ライトモード | ダークモード | 用途 |
|------------|------------|------|
| #e0e0e0 | #3c4043 | 主要ボーダー |
| #dadce0 | #5f6368 | セカンダリボーダー |

#### アクセント色
| ライトモード | ダークモード | 用途 |
|------------|------------|------|
| #1a73e8 | #8ab4f8 | プライマリ（青） |
| #FF6B35 | #ff8a65 | 再生中（オレンジ） |
| #ea4335 | #f28b82 | エラー/重要（赤） |

## 3. 実装手順

### Phase 1: 基盤構築（CSS変数化）
1. CSS変数の定義ファイル作成（`themes.css`）
2. 既存のCSSファイルの色をCSS変数に置き換え
3. ルート要素へのテーマ属性追加機能

### Phase 2: UI実装
1. ダークモード切り替えボタンの追加
   - ヘッダー右上に配置
   - アイコン: 🌙（ダーク）/ ☀️（ライト）
2. システム設定との連携オプション
   - 「システム設定に従う」チェックボックス
3. トランジション効果の追加

### Phase 3: 機能実装
1. ローカルストレージでの設定保存
2. `prefers-color-scheme`メディアクエリのサポート
3. 初回読み込み時のちらつき防止

### Phase 4: 細部調整
1. コントラスト比の確認（WCAG AA基準）
2. シャドウとオーバーレイの調整
3. タグ色のダークモード対応
4. アイコンとイメージの調整

## 4. 考慮事項

### 4.1 パフォーマンス
- CSS変数は現代のブラウザで高速
- トランジション時のrepaint/reflowを最小化
- 初回読み込み時のFOUC（Flash of Unstyled Content）防止

### 4.2 アクセシビリティ
- コントラスト比の確保（最低4.5:1）
- フォーカス状態の明確な表示
- キーボードナビゲーションのサポート

### 4.3 互換性
- Chrome/Edge/Firefox/Safariでのテスト
- CSS変数未対応ブラウザのフォールバック（必要に応じて）

### 4.4 UXの考慮
- スムーズなトランジション（200ms）
- システム設定変更時の自動追従
- 一貫性のある色使い

## 5. ファイル変更リスト

### 新規作成
- `src/styles/themes.css` - テーマ定義
- `src/common/theme-manager.js` - テーマ管理ロジック

### 修正必要
- `src/sidepanel/sidepanel.css` - CSS変数化
- `src/sidepanel/sidepanel.js` - テーマ切り替え機能
- `src/sidepanel/sidepanel.html` - 切り替えボタン追加
- `styles/content.css` - CSS変数化
- `manifest.json` - 権限追加（必要に応じて）

## 6. テスト項目

### 機能テスト
- [ ] ダークモード切り替えが正常に動作
- [ ] 設定がローカルストレージに保存される
- [ ] ページリロード後も設定が維持される
- [ ] システム設定との連携が動作

### 視覚テスト
- [ ] 全てのコンポーネントでダークモードが適用
- [ ] コントラスト比が基準を満たす
- [ ] トランジションがスムーズ
- [ ] ちらつきがない

### 互換性テスト
- [ ] Chrome
- [ ] Edge
- [ ] Firefox
- [ ] Safari

## 7. 実装スケジュール

1. **Phase 1**: 2-3時間（CSS変数化）
2. **Phase 2**: 1-2時間（UI実装）
3. **Phase 3**: 2-3時間（機能実装）
4. **Phase 4**: 2-3時間（細部調整とテスト）

合計: 約8-11時間

## 8. リスクと対策

### リスク
1. 既存の色指定の見落とし
2. 動的に生成される要素への対応漏れ
3. パフォーマンスの低下

### 対策
1. 体系的な色の置き換え作業
2. 動的要素の洗い出しとテスト
3. パフォーマンス計測とボトルネック解消